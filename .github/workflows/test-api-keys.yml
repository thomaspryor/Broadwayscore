name: Test API Keys
on:
  workflow_dispatch:

jobs:
  test-keys:
    runs-on: ubuntu-latest
    steps:
      - name: Test Gemini API Key
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "Testing Gemini API..."
          RESPONSE=$(curl -s -w "\n%{http_code}" "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}" \
            -H "Content-Type: application/json" \
            -d '{"contents":[{"role":"user","parts":[{"text":"Reply with exactly: API_KEY_WORKS"}]}]}')
          HTTP_CODE=$(echo "$RESPONSE" | tail -1)
          BODY=$(echo "$RESPONSE" | sed '$d')
          echo "HTTP Status: $HTTP_CODE"
          if [ "$HTTP_CODE" = "200" ]; then
            echo "✅ Gemini API key is valid and working"
            echo "$BODY" | jq -r '.candidates[0].content.parts[0].text'
          else
            echo "❌ Gemini API key failed with status $HTTP_CODE"
            echo "$BODY" | jq '.'
          fi

      - name: Test OpenAI API Key
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "Testing OpenAI API..."
          RESPONSE=$(curl -s -w "\n%{http_code}" https://api.openai.com/v1/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $OPENAI_API_KEY" \
            -d '{"model":"gpt-4o-mini","messages":[{"role":"user","content":"Reply with exactly: API_KEY_WORKS"}],"max_tokens":10}')
          HTTP_CODE=$(echo "$RESPONSE" | tail -1)
          BODY=$(echo "$RESPONSE" | sed '$d')
          echo "HTTP Status: $HTTP_CODE"
          if [ "$HTTP_CODE" = "200" ]; then
            echo "✅ OpenAI API key is valid and working"
            echo "$BODY" | jq -r '.choices[0].message.content'
          else
            echo "❌ OpenAI API key failed with status $HTTP_CODE"
            echo "$BODY" | jq '.'
          fi
